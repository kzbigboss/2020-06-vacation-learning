if __name__ == "__main__":
    import requests
    import random
    import pandas as pd

    # get the data
    symbol = "AAPL"
    resolution = "1"
    minute_start = "1593068400"
    minute_end = "1593154799"
    token = "brjs1f7rh5r9g3ot9oa0"

    url = "https://finnhub.io/api/v1/stock/candle?symbol=AAPL&resolution=1&from=1593068400&to=1593154799&token=brjs1f7rh5r9g3ot9oa0"

    result = requests.get(url)

    j = result.json()

    j.pop("s")

    # reduce to interested observations
    interested_timestamps = [1593097440, 1593106140, 1593111000, 1593094740, 1593105660, 1593110760, 1593088200,
                             1593108360, 1593111060, 1593101280, 1593098880, 1593100500, 1593073020, 1593117540,
                             1593096840, 1593097620, 1593125040, 1593096600, 1593088800, 1593100620, 1593096480,
                             1593119220, 1593101700, 1593087780, 1593073680, 1593087960, 1593112920, 1593091140,
                             1593110280, 1593106980, 1593119520, 1593102840, 1593104460, 1593118500, 1593083940,
                             1593085980, 1593129060, 1593099720, 1593085020, 1593085740, 1593105960, 1593116580,
                             1593116460, 1593121620, 1593093900, 1593115200, 1593111240, 1593098280, 1593095100,
                             1593129000, 1593076620, 1593082200, 1593125940, 1593100200, 1593105840, 1593105000,
                             1593101880, 1593112860, 1593099240, 1593109560, 1593109320, 1593099600, 1593102720,
                             1593091920, 1593086820, 1593084960, 1593113100, 1593111420, 1593105720, 1593122280,
                             1593113580, 1593098040, 1593086160, 1593111900, 1593114720, 1593096960, 1593109440,
                             1593126120, 1593098220, 1593097200, 1593089760, 1593106440, 1593099360, 1593086460,
                             1593095580, 1593094980, 1593128460, 1593086220, 1593098820, 1593099060, 1593107880,
                             1593092100, 1593108960, 1593087060, 1593102780, 1593096300, 1593112200, 1593124020,
                             1593091020, 1593091980, 1593106260, 1593101760, 1593100980, 1593124560, 1593096720,
                             1593118320, 1593100440, 1593113220, 1593112380, 1593117420, 1593098520, 1593124140,
                             1593093960, 1593096120, 1593093300, 1593107280, 1593121140, 1593103260, 1593107760,
                             1593108120, 1593118680, 1593108180, 1593091740, 1593087660, 1593117240, 1593126240,
                             1593093660, 1593106560, 1593114420, 1593126960, 1593117780, 1593103560, 1593077040,
                             1593104160, 1593098760, 1593105180, 1593087720, 1593075060, 1593093780, 1593079200,
                             1593119340, 1593111120, 1593129420, 1593117300, 1593118980, 1593116100, 1593076560,
                             1593118260, 1593125340, 1593118800, 1593098700, 1593085260, 1593107520, 1593098640,
                             1593119400, 1593104880, 1593119100, 1593122460, 1593084240, 1593084660, 1593111660,
                             1593097680, 1593094140, 1593088920, 1593128940, 1593074580, 1593114660, 1593115020,
                             1593108420, 1593112980, 1593128820, 1593094320, 1593112500, 1593125520, 1593117060,
                             1593083160, 1593104400, 1593123540, 1593110400, 1593124320, 1593111360, 1593125400,
                             1593124980, 1593113640, 1593087180, 1593093720, 1593108060, 1593087120, 1593104100,
                             1593122340, 1593126720, 1593105540, 1593090360, 1593100020, 1593087900, 1593095220,
                             1593107160, 1593119760, 1593111300, 1593101340]

    df = pd.DataFrame.from_dict(j, orient='index').transpose()

    df_interested = df[df["t"].isin(interested_timestamps)]

    # for each interested observation, prepare firehose payload

    for i, timestamp in enumerate(j["t"]):
        if timestamp in interested_timestamps:
            data_chunk = {
                "symbol": symbol,
                "c": j["c"][i],
                "h": j["h"][i],
                "l": j["l"][i],
                "o": j["o"][i],
                "t": j["t"][i]
                # ,"capture_time": 1593129600,
            }

            print(data_chunk)

    pass
